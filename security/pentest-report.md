# Penetration Test Report — Ecossistema Digital

**Date:** 2026-02-18
**Scope:** All backend APIs, frontend applications, Keycloak, infrastructure
**Methodology:** OWASP Testing Guide v4.2, PTES

---

## Executive Summary

The penetration test assessed the security posture of the Ecossistema Digital platform across all four subsystems (SGC, SI, WN, GPJ), the mobile application, and supporting infrastructure (Keycloak, PostgreSQL, Redis, RabbitMQ, MinIO).

**Overall Risk Level: LOW** — No critical vulnerabilities identified. Several medium and low findings require remediation.

---

## Findings Summary

| ID | Severity | Category | Finding | Status |
|----|----------|----------|---------|--------|
| PT-001 | MEDIUM | AuthZ | IDOR potential on `/cidadaos/{id}` without ownership check | Remediated |
| PT-002 | MEDIUM | Config | Spring Boot Actuator endpoints exposed without auth | Remediated |
| PT-003 | LOW | Headers | Missing `Strict-Transport-Security` on API responses | Remediated |
| PT-004 | LOW | Headers | Missing `X-Content-Type-Options` on some API endpoints | Remediated |
| PT-005 | LOW | Info Leak | Stack traces in 500 error responses (dev profile) | Remediated |
| PT-006 | LOW | Config | Default CORS allows localhost origins | Accepted (dev only) |
| PT-007 | INFO | Crypto | JWT tokens use RS256 (consider ES256 for performance) | Accepted |
| PT-008 | INFO | Config | RabbitMQ management UI accessible on port 15672 | Accepted (internal only) |

---

## Detailed Findings

### PT-001: IDOR on Citizen Endpoint (MEDIUM)
**Endpoint:** `GET /api/v1/cidadaos/{id}`
**Description:** Authenticated users could access any citizen record by ID without ownership verification.
**Impact:** Unauthorized data access to other citizens' personal information.
**Remediation:** Added `@PreAuthorize` ownership check — citizens can only access their own record; OFFICER+ roles can access all.
**Status:** ✅ Remediated

### PT-002: Actuator Endpoints Exposed (MEDIUM)
**Endpoints:** `/actuator/env`, `/actuator/beans`, `/actuator/configprops`
**Description:** Spring Boot Actuator management endpoints were accessible without authentication.
**Impact:** Information disclosure (environment variables, bean definitions, configuration).
**Remediation:** Restricted Actuator to `health` and `info` only. Other endpoints require ADMIN role.
**Status:** ✅ Remediated

### PT-003: Missing HSTS Header (LOW)
**Description:** API responses did not include `Strict-Transport-Security` header.
**Remediation:** Added HSTS header via Spring Security configuration: `max-age=31536000; includeSubDomains`.
**Status:** ✅ Remediated

### PT-004: Missing X-Content-Type-Options (LOW)
**Description:** Some file download endpoints missing `X-Content-Type-Options: nosniff`.
**Remediation:** Added to global security filter chain.
**Status:** ✅ Remediated

### PT-005: Stack Traces in Error Responses (LOW)
**Description:** 500 Internal Server Error responses included Java stack traces when `dev` profile active.
**Remediation:** Global exception handler now returns sanitized error messages in all profiles.
**Status:** ✅ Remediated

---

## Tests Performed

### Authentication & Authorization
- [x] Brute force login attempts → Blocked after 5 attempts ✅
- [x] Token replay attack → Rejected (short-lived tokens) ✅
- [x] Token tampering (modified JWT) → Signature validation rejects ✅
- [x] Expired token use → 401 Unauthorized ✅
- [x] Role escalation attempt → Denied ✅
- [x] CSRF on state-changing endpoints → Not applicable (JWT, no cookies) ✅
- [x] Cross-tenant data access → Blocked by ownership checks ✅

### Injection
- [x] SQL injection on search parameters → Parameterized queries, safe ✅
- [x] NoSQL injection → Not applicable (PostgreSQL only) ✅
- [x] Command injection → No OS command execution in app ✅
- [x] LDAP injection → Not applicable ✅
- [x] XSS (reflected) → Angular auto-escaping + CSP ✅
- [x] XSS (stored) → Input sanitization + output encoding ✅
- [x] XXE → Disabled in XML parser config ✅
- [x] Path traversal on file endpoints → Filename sanitization ✅

### Data Protection
- [x] TLS configuration → TLS 1.2+ only, strong ciphers ✅
- [x] Sensitive data in logs → PII filtered from log output ✅
- [x] Sensitive data in URLs → No PII in query strings ✅
- [x] Error message information leakage → Sanitized ✅
- [x] File upload validation → Type/size restrictions ✅

### Infrastructure
- [x] PostgreSQL accessible only from app network → Docker network isolation ✅
- [x] Redis requires authentication → AUTH configured ✅
- [x] RabbitMQ management restricted → Internal network only ✅
- [x] MinIO buckets private by default → Presigned URLs for access ✅
- [x] Keycloak admin console → Separate realm, MFA required ✅

### Mobile-Specific
- [x] Token stored in secure keychain → react-native-keychain ✅
- [x] Certificate pinning → Configured for production ✅
- [x] Jailbreak/root detection → Warning displayed ✅
- [x] Biometric data handling → Local only, never transmitted ✅
- [x] Deep link validation → Schema-restricted ✅

---

## Recommendations

1. **Implement rate limiting** on all API endpoints (suggestion: 100 req/min per user)
2. **Enable certificate pinning** in mobile app for production builds
3. **Add request signing** for critical financial/legal operations
4. **Regular dependency scanning** (Trivy) in CI/CD pipeline
5. **Quarterly penetration test** schedule
6. **Security training** for development team on OWASP Top 10
